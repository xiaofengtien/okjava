#### Zookeeper 保证CP

当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down调不可用，也就是说，**服务注册功能对可用性的要求高宇一致性。**
但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点回重新进行leader选举，问题在于选举leader的时间太长，30~120s且选举期间整个zk集群都是不可用的。这就导致在选举期间注册服务瘫痪，在云部署的环境下，因网络问题使得zk集群失去master节点很大概率会发生的事情。虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用时不能容忍的。

#### Eureka 保证AP

eureka 看明白了这一点，因此在设计时就先保证可用性。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而eureka客户端再向某个eureka服务端注册时如果发现连接失败，则会自动切换至其他节点。只要有一台eureka server 是ok的，就能保证服务可用(**保证服务可用**)。只不过查询到的信息可能不是最新的(**不保证强一致性**)。除此之外，eureka还有一种自我保护机制，上篇中也?说。如果在15分钟内超过85%的节点都没有正常的心跳，那么eureka就认为客户端与注册中心出现了网络故障，此时会出现如下几种情况：

1. eureka 不再从注册列表中移除因为长时间没收到心跳而应该过期的服务。
2. eureka 仍然能够接受新服务的注册和查询请求，但是不会被同步到其他节点上(即保证当前节点依然可用)
3. 当网络稳定时，当前实例新的注册信息会被同步到其他节点中，因此，eureka可以很好的应对网络故障导致部分节点失去联系的情况而不会像zk那样使整个注册服务瘫痪



> eureka为什么选择AP，这跟他的功能有关，他只专注于服务注册和发现，并不会出现数据的竞态条件：
> 竞态条件 有同时多个线程竞争同一数据，可能会发生数据不正确的问题

> ![image.png](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDgyODg2OS1kNjU4N2ExZTA5N2MyYzIzLnBuZw)
> 如图:每个client只会向一个eureka server注册，所以并不会出现数据竞态条件，eureka server只需要将其它节点的数据来取过来就好，并不会出现在别的节点拉取到和自己不一致的数据的问题。
> 就算出现了，数据不一致问题，比如一个client宕机后重启链接了其它节点。因为是用于服务注册，只要覆盖就旧数据就好了。
> `eureka保证的是最终一致性，最终所有eureka server中的数据会保持一致`